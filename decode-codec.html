<html>
<head>
<title>Codec string decoder</title>

</head>


<body>
<h1>Codec string decrypter</h1>

<p>Enter string: codecs="<input type="text" id="param"/>"
<button type="button" onclick="checkCodec()">Check</button>
</p>
<div id="results"/>

<script src="./sscanf-func.js" type="text/javascript"></script> 


<script type="text/javascript">
function decodeHEVC(val) {
	var parts=val.split(".")
}

function hexDigits(str) {
	var i,rc=true;
	res=str.match(/[\da-fA-F]+/)
	return res?res==str:false;
}


function AVCconstraint(val, constraint) {
	// constraint 012345--
	// bit        76543210	
	if (constraint<0 || constraint>5) return false;
	return (val & Math.pow(2, 7-constraint))	
}
/**
 * https://blog.pearce.org.nz/2013/11/what-does-h264avc1-codecs-parameters.html
 * https://en.wikipedia.org/wiki/Advanced_Video_Coding
 **/
function decodeAVC(val) {
	var parts=val.split(".")
	var res=""
	res+="[1]="+parts[0]+" [2]="+parts[1]+"<br>"
	
	if (parts[1].length==6) {
		if (hexDigits(parts[1])) {
			var prof=sscanf(parts[1], "%2x%2x%2x")	
			res+="profile_idc="+prof[0]+" constraint_set="+prof[1]+" level_idc="+prof[2]+"<br>"
			
			res+="profile="
			switch (prof[0]) {
				case 66: res+=AVCconstraint(prof[1], 1)?"Constrained ":""+"Baseline"; break
				case 77: res+="Main"; break
				case 100: 
					if (AVCconstraint(prof[1], 4) && !AVCconstraint(prof[1], 5))
						res+="Progressive "
					if (AVCconstraint(prof[1], 4) && AVCconstraint(prof[1], 5))
						res+="Constrained "	
					res+="High"; break
				case 122: res+="High 4:2:2"+AVCconstraint(prof[1], 3)?" Intra":""; break
				case 110: res+="High 10"+AVCconstraint(prof[1], 3)?" Intra":""; break
				case 144: res+="High 4:4:4"+AVCconstraint(prof[1], 3)?" Intra":""; break
				case 88: res+="Extended"; break
				case 83: res+="Scalable "+AVCconstraint(prof[1], 5)?"Constrained ":""+"Base"; break
				case 86: res+="Scalable "
					if (AVCconstraint(prof[1], 5) && !AVCconstraint(prof[1], 3)) res+="Constrained "
					if (AVCconstraint(prof[1], 3) && !AVCconstraint(prof[1], 5)) res+="Intra "
					res+="High"; break
				case 118: res+="Multiview High"; break
				case 128: res+="Stereo High"; break
				case 134: res+="MFC High"; break
				case 135: res+="MFC Depth High"; break
				case 138: res+="Multiview Depth High High"; break
				case 139: res+="Enhanced Multiview Depth High High"; break
				default:
					res+="unknown"					
			}
			res+=" ("+prof[0].toString(16)+")<br>"
			
			res+="constraints="
			for (var i=0; i<=5; i++)
				res+=(AVCconstraint(prof[1], i)?i:"-")
			res+="<br>"
			
			res+="level="
			switch (prof[2]) {
				case 10: res+="1"; break
				case 11: res+=AVCconstraint(prof[1], 3)?"1b":"1.1"; break
				case 12: res+="1.2"; break
				case 13: res+="1.3"; break
				case 20: res+="2"; break
				case 21: res+="2.1"; break
				case 22: res+="2.2"; break
				case 30: res+="3"; break
				case 31: res+="3.1"; break
				case 32: res+="3.2"; break
				case 40: res+="4"; break
				case 41: res+="4.1"; break
				case 42: res+="4.2"; break
				case 50: res+="5"; break
				case 51: res+="5.1"; break
				case 52: res+="5.2"; break
				case 60: res+="6"; break
				case 61: res+="6.1"; break
				case 62: res+="6.2"; break
			}
			res+=" ("+prof[2].toString(16)+")<br>"
		}
		else
			res+="parameters contains non-hex digits<br>"
	}
	else 
		res+="invalid parameters length ("+parts[1].length+") - should be 6<br>"
	return res;
}


function decode(val) {

	var codec=(val.indexOf(".") == -1)?val:val.substr(0, val.indexOf("."))
	var res=""

	switch (codec.toLowerCase()) {
		case "hev1":
		case "hvc1":
			res="HEVC/H.265<br>"+decodeHEVC(val)
			break
		case "avc1":
			res="AVC/H.264<br>"+decodeAVC(val)
			break
		default:
			res="<i>unsupported codec=</i>"+codec
	}
	
	return res;
}

function checkCodec() {
	var val, res;
	
	val=document.getElementById("param").value;
	res=decode(val);
	document.getElementById("results").innerHTML="<hr><h2>Results</h2><br>"+res;
}
</script>

</body>
</html>